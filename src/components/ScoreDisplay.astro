---
import Button from './Button.astro';
const { sliderId } = Astro.props; 
---

<div class="score-table" data-slider-id={sliderId}>
    <h2>Score Summary</h2>
   
    <div id="percentage-display" class="percentage-display"></div>

    <div class="scrollable-container">
        <table id="score-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Your Answer</th>
                    <th>Correct Answer</th>
                    <th>Result</th>
                </tr>
            </thead>
            <tbody id="score-table-body">
               
            </tbody>
        </table>
    </div>

    <div class="take-again-button">
        <Button 
            id="take-again-btn" 
            text="Take Again" 
            className="btn-green" 
            onClick={() => {
            
                window.location.reload(); 
            }} 
        />
    </div>
</div>

<script>
    import { getAnswers, getScore } from '../utils/checkAnswer.js';


    document.addEventListener('DOMContentLoaded', () => {

        const scoreTables = document.querySelectorAll('.score-table');

        scoreTables.forEach((scoreTable) => {
        
            const sliderId = scoreTable.getAttribute('data-slider-id');
            if (!sliderId) {
                return;
            }

            document.addEventListener('answersUpdated', (event) => {


                if (event.detail.sliderId === sliderId) {
                    updateScoreTable(scoreTable, sliderId);
                }
            });

            updateScoreTable(scoreTable, sliderId);
        });

        function updateScoreTable(scoreTable, sliderId) {
            const answers = getAnswers(sliderId); 
            const tableBody = scoreTable.querySelector('#score-table-body');
            tableBody.innerHTML = ''; 

            answers.forEach((answer, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${answer.userInput}</td>
                    <td>${answer.correctAnswer}</td>
                    <td>${answer.isCorrect ? '✅' : '❌'}</td>
                `;
                tableBody.appendChild(row);
            });

            const score = getScore(sliderId);
            const totalQuestions = answers.length;
            const percentage = totalQuestions > 0 ? ((score / totalQuestions) * 100).toFixed(2) : 0;

            const percentageDisplay = scoreTable.querySelector('#percentage-display');
            percentageDisplay.textContent = `Percentage: ${percentage}%`;
        }

        const takeAgainButtons = document.querySelectorAll('#take-again-btn');
        takeAgainButtons.forEach((button) => {
            button.addEventListener('click', () => {
                window.location.reload();
            });
        });
    });
</script>

<style>

.score-table {
    margin: 20px;
    padding: 10px;
    border: none; 
}

.percentage-display {
    margin: 10px 0;
    font-size: 18px;
    font-weight: bold;
    text-align: center;
}


.scrollable-container {
    max-height: 450px; 
    max-width: 500px;
    overflow-y: auto;
}


table {
    width: 100%;
    border-collapse: collapse;
    border: none; 
}

th, td {
    padding: 10px 40px; 
    text-align: center;
}

th {
    color: #333; 
    border: none; 
}


td {
    border: none;
}

tbody, tr {
    border: none;
}

.take-again-button {
    margin-top: 40px;
    text-align: center;
}

#score-table th:nth-child(1),
#score-table td:nth-child(1) {
    width: 5%;
}

#score-table th:nth-child(2),
#score-table td:nth-child(2) {
    width: 45%;
}

#score-table th:nth-child(3),
#score-table td:nth-child(3) {
    width: 45%;
}

#score-table th:nth-child(4),
#score-table td:nth-child(4) {
    width: 5%;
}


</style>